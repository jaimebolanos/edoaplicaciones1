window.GGBT_social_share=function($){"use_strict";function generateEmbedCode(){var params=[];params["sharing_key"]=$("#sel_material").val();params["title"]=$("#sel_material").find(":selected").data("title");params["type"]=$("#sel_type").val();params["width"]=$("#embed_width").val();params["height"]=$("#embed_height").val();params["borderColor"]=$("#border_color").val().replace("#","");if(params["type"]=="HTML"){var result='<iframe scrolling="no" title="'+params["title"]+'" src="'+ROOT_URL.replace(/^http?:/,"https:")+"/material/iframe/id/"+params["sharing_key"]+"/width/"+params["width"]+"/height/"+params["height"]+"/border/"+params["borderColor"]+($("#show_menu_bar").is(":checked")?"/smb/true":"/smb/false")+($("#show_tool_bar").is(":checked")?"/stb/true":"/stb/false")+($("#show_tool_bar_help").is(":checked")?"/stbh/true":"/stbh/false")+($("#show_algebra_input").is(":checked")?"/ai/true":"/ai/false")+($("#show_style_bar").is(":checked")?"/asb/true":"/asb/false")+($("#show_reset_icon").is(":checked")?"/sri/true":"/sri/false")+($("#enable_right_click").is(":checked")?"/rc/true":"/rc/false")+($("#enable_label_drags").is(":checked")?"/ld/true":"/ld/false")+($("#enable_shift_drag_zoom").is(":checked")?"/sdz/true":"/sdz/false")+($("#enable_click_to_load").is(":checked")?"/ctl/true":"/ctl/false")+'" width="'+params["width"]+'px" height="'+params["height"]+'px" style="border:0px;"> </iframe>'}else if(params["type"]=="mediawiki"){var key=$("#sel_material").val();var m=usedMaterials[key],x;var result="<ggb_applet "+'id="'+params["sharing_key"]+'" '+'width="'+params["width"]+'" '+'height="'+params["height"]+'" '+'border="'+params["borderColor"]+'" '+((x=$("#show_menu_bar").is(":checked"))!=(m.showMenuBar=="true")?'smb="'+(x?"true":"false")+'" ':"")+((x=$("#show_tool_bar").is(":checked"))!=(m.showToolBar=="true")?'stb="'+(x?"true":"false")+'" ':"")+((x=$("#show_tool_bar_help").is(":checked"))!=(m.showToolBarHelp=="true")?'stbh="'+(x?"true":"false")+'" ':"")+((x=$("#show_algebra_input").is(":checked"))!=(m.showAlgebraInput=="true")?'ai="'+(x?"true":"false")+'" ':"")+((x=$("#show_style_bar").is(":checked"))!=(m.allowStyleBar=="true")?'asb="'+(x?"true":"false")+'" ':"")+((x=$("#show_reset_icon").is(":checked"))!=(m.showResetIcon=="true")?'sri="'+(x?"true":"false")+'" ':"")+((x=$("#enable_right_click").is(":checked"))!=(m.enableRightClick=="true")?'rc="'+(x?"true":"false")+'" ':"")+((x=$("#enable_label_drags").is(":checked"))!=(m.enableLabelDrags=="true")?'ld="'+(x?"true":"false")+'" ':"")+((x=$("#enable_shift_drag_zoom").is(":checked"))!=(m.enableShiftDragZoom=="true")?'sdz="'+(x?"true":"false")+'" ':"")+((x=$("#enable_click_to_load").is(":checked"))!=(m.enableClickToLoad=="true")?'ctl="'+(x?"true":"false")+'" ':"")+"/>"}else{var result=ROOT_URL.replace(/^http:/,"https:")+"/material/gsites/id/"+params["sharing_key"]+"/width/"+params["width"]+"/height/"+params["height"]}$("#embed_text").val(result)}var usedMaterials=null;function setUsedMaterials(um){usedMaterials=[];um.forEach(function(m,i){if(typeof m.value=="undefined"){usedMaterials[m.sharing_key]=m}else{usedMaterials[m.sharing_key]=$.parseJSON(m.value)}})}function loadAppletData(){var key=$("#sel_material").val();var m=usedMaterials[key];if(typeof m.parameters!="undefined"){m=m.parameters}$("#preserve_aspect").prop("checked",true);$("#embed_height").val(m.height).data("ratio",m.height/m.width);$("#embed_width").val(m.width).data("ratio",m.width/m.height);$("#show_menu_bar").prop("checked",m.showMenuBar=="true");$("#show_tool_bar").prop("checked",m.showToolBar=="true");$("#tool_bar_help").toggle(m.showToolBar=="true");$("#show_tool_bar_help").prop("checked",m.showToolBar=="true"&&m.showToolBarHelp=="true");$("#show_algebra_input").prop("checked",m.showAlgebraInput=="true");$("#show_style_bar").prop("checked",m.allowStyleBar=="true");$("#show_reset_icon").prop("checked",m.showResetIcon=="true");$("#enable_right_click").prop("checked",m.enableRightClick=="true");$("#enable_label_drags").prop("checked",m.enableLabelDrags=="true");$("#enable_shift_drag_zoom").prop("checked",m.enableShiftDragZoom=="true")}function initEmbed(){initShowMore();window.GGBT_clipboard.initClipboardButtons();loadAppletData();generateEmbedCode();$(".onlinkchange").off("change").change(generateEmbedCode);$("#sel_material").off("change").change(function(){loadAppletData();generateEmbedCode()});$("#sel_type").off("change").change(function(){$(".j-hidable-embed-options").toggle($(".j-hidable-embed-options").hasClass($("#sel_type").val()));window.GGBT_gen_modal.resetHeight();generateEmbedCode()});var onlyNumbers=function(e){if(e.which!=8&&e.which!=0&&(e.which<48||e.which>57)){return false}};$("#embed_width, #embed_height").off("change").keypress(onlyNumbers).keyup(function(){if($("#preserve_aspect").is(":checked")){var target=$(this.getAttribute("data-aspect-target"));target.val(Math.floor(this.value*target.data("ratio")))}generateEmbedCode()});$("#preserve_aspect").off("change").change(function(){if($("#preserve_aspect").is(":checked")){$("#embed_height").val(Math.floor($("#embed_width").val()*$("#embed_height").data("ratio")))}generateEmbedCode()});$("#border_color").off("keyup").keyup(generateEmbedCode);$("#show_tool_bar").off("change").change(function(){$("#tool_bar_help").toggle($("#show_tool_bar").is(":checked"));$("#show_tool_bar_help").prop("checked",$("#show_tool_bar").is(":checked")&&$("#show_tool_bar_help").is(":checked"));generateEmbedCode()})}function initShowMore(){$(".show-more-options-container .btn-container").on("click",function(e){var btnContainer=$(e.target);if(!btnContainer.hasClass("btn-container")){btnContainer=btnContainer.closest(".btn-container")}var btnMore=btnContainer.find(".btn-show-more");var btnLess=btnContainer.find(".btn-show-less");var more=btnMore.is(":visible");btnContainer.siblings(".more-options-content").toggle(more);btnMore.toggle(!more);btnLess.toggle(more);window.GGBT_gen_modal.resetHeight()})}function initEMail(){var shareForm=$(".popup-social-share #share_email_form");shareForm.submit(function(e){jQuery.ajax({url:jQuery(this).attr("action"),type:"post",data:shareForm.serialize(),dataType:"json"}).done(function(data){$(".popup-social-share .message-email-error, .popup-social-share .message-success").css("display","none");if(data.status.match(/^error/)){var messageList=$(".popup-social-share .message-email-error");messageList.css("display","block");messageList.empty();messageList.append(data.message)}else{var messageList=$(".popup-social-share .message-success");messageList.css("display","block");messageList.empty();messageList.append(data.message);shareForm[0].reset()}window.GGBT_gen_modal.resetHeight()}).fail(function(data,error){var messageList=$(".popup-social-share .message-email-error");messageList.css("display","block");messageList.empty();messageList.append(data.message)});return false})}function loadAvailableGroups(button){var popup=$(".popup-social-share");var selectgroup=$("#selectgroup",popup);selectgroup.attr("disabled",true);$("#selectgroup_btn",popup).attr("disabled",true);$.ajax("/group/list",{async:true}).success(function(response){if(response.type==="success"){if(response.newData.length>0){var groups=response.newData;selectgroup.find("option:not(:first)").remove();$.each(groups,function(key,group){selectgroup.append($('<option value="'+group.group_id+'">'+group.title+"</option>"))})}$("#selectgroup_btn",popup).on("click",function(){var groupId=selectgroup.val();var is_book=button.data("is-book");if(is_book){var obj={id:button.data("id"),group_id:groupId}}else{var obj={material_id:button.data("id"),group_id:groupId}}$.ajax(is_book?"/group/importbook/":"/group/importworksheet/",{async:true,data:obj}).success(function(response){if(response.type==="success"){window.GGBT_gen_singleton.processUrl("/group/stream/id/"+response.newData.sharingkey)}else{if(typeof response.message.redirect!=="undefined")window.location.replace(response.message.redirect+encodeURIComponent(window.location.href));window.GGBT_gen_edit.setSaveStateError(response.message)}}).fail(function(response){window.GGBT_gen_edit.setSaveStateError(response.responseText)})})}else{window.GGBT_gen_edit.setSaveStateError(response.message)}}).fail(function(response){window.GGBT_gen_edit.setSaveStateError(response.responseText)}).always(function(){selectgroup.attr("disabled",false);$("#selectgroup_btn",popup).attr("disabled",false)})}function initSocialSharePopup(button){window.GGBT_tabs.init(".popup-social-share");$(".popup-social-share .tab_bar li").on("click",function(e){$("#pso_visibility_selection").toggle($("#privacy").val()=="P"&&$("#pso_visibility_selection").data("visible-on-tabs").indexOf($(this).data("page-id"))>=0);window.GGBT_gen_modal.resetHeight()});loadAvailableGroups(button);function privateVisibility(){var privacy=$("#privacy").val();$(".hide-on-private").toggle($("#privacy").val()!="P");$(".show-on-private").toggle($("#privacy").val()=="P"&&$("#pso_visibility_selection").data("visible-on-tabs").indexOf($(this).data("page-id"))>=0);window.GGBT_gen_modal.resetHeight()}$("#privacy").on("change",function(){function submit(outer_this){var success=function(result){if(typeof result=="string"){window.GGBT_gen_edit.setSaveStateSuccessful();$("#privacy").data("saved-value",$("#privacy").val());privateVisibility()}else{fail(result)}};var fail=function(result){if(result.message!==undefined){window.GGBT_gen_edit.setSaveStateError(result.message);var oldVal=$("#privacy").data("saved-value");$("#privacy").val(oldVal)}};window.GGBT_gen_edit.setSaveStateInProgress();window.GGBT_spinner.attachSpinner();$.post($(outer_this).data("url"),{visibility:$(outer_this).val()},success).fail(fail).always(function(){window.GGBT_spinner.removeSpinner()})}if(hasPrivateMaterials&&originalVisibility=="P"&&$("input:radio[name='visibility']:checked").val()!="P"){if(confirm(confirm_share_materials)){submit(this)}}else{submit(this)}return false});privateVisibility();initEMail();if(embed_enabled){initEmbed()}$(".sharing-link").on("focus",function(e){if(typeof e.originalEvent=="object"){$(e.target).select()}})}function initSocialShareButtons(){$("body").on("click",function(e){if($(e.target).is(".btn_social_share_popup")){if($(e.target).attr("disabled")!=="disabled"){showSocialSharePopup($(e.target))}}})}function showSocialSharePopup(button){var url=button.data("url");window.GGBT_gen_modal.showAjaxPopup(url,{id:button.data("id"),type:button.data("type")},{className:"popup-social-share popup-easing",autoPosition:true,autoResize:true},button.data("title"),function(){},function(){initSocialSharePopup(button)})}function init(){initSocialShareButtons()}return{init:init,setUsedMaterials:setUsedMaterials,initSocialSharePopup:initSocialSharePopup}}(jQuery);$(document).ready(function($){"use_strict";window.GGBT_social_share.init()});