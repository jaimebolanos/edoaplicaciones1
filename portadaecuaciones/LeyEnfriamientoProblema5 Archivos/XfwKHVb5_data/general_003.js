window.GGBT_objects_general=function(){"use strict";function initOnLoad(){var hash=location.hash;try{hash=parent.location.hash}catch(e){}if(hash!==""){hash=hash.substr(1);var elem=$(".jAnchor[data-id='"+hash+"']");if(elem.length>0){$("html, body").animate({scrollTop:elem.offset().top-43},1e3);elem.addClass("selected");setTimeout(function(){elem.removeClass("selected")},1500)}}}function buttonClickHandlers(e){var ex=$(e.target);if($(".rename-title").length>0&&!$(e.target).hasClass("j-object-rename-field")){toggleRenameField($(".rename-title").closest(".jItem"))}if(ex.is(".jDeleteGroup")){e.preventDefault();if(!ex.is("[disabled]")&&!$("a",e.target).is("[disabled]")){var link=ex.closest(".jDeleteGroup");window.GGBT_gen_modal.showYesNoPopup(link.data("confirm"),function(){deleteGroup(link)},null,link.data("confirm-yes"),link.data("confirm-no"))}}else if(ex.is(".jLeaveGroup")){e.preventDefault();if(!ex.is("[disabled]")&&!$("a",e.target).is("[disabled]")){var link=ex.closest(".jLeaveGroup");window.GGBT_gen_modal.showYesNoPopup(link.data("confirm"),function(){window.location.href=link.data("url")},null,link.data("confirm-yes"),link.data("confirm-no"))}}else if(ex.is(".btn_remove_access")){e.preventDefault();if(!ex.is("[disabled]")&&!$("a",e.target).is("[disabled]")){var link=ex.closest(".btn_remove_access");window.GGBT_gen_modal.showYesNoPopup(link.data("confirm"),function(){window.location=link.attr("href")},null,link.data("confirm-yes"),link.data("confirm-no"))}}else if(ex.is(".jDelete")){e.preventDefault();if(!ex.is("[disabled]")&&!$("a",e.target).is("[disabled]")){var link=ex.closest(".jDelete");window.GGBT_gen_modal.showYesNoPopup(link.data("confirm"),function(){window.location=link.attr("href")},null,link.data("confirm-yes"),link.data("confirm-no"))}}else if(ex.is(".jRenameObject")){e.preventDefault();if(ex.closest(".jItem").length>0){toggleRenameField(ex.closest(".jItem"))}else{toggleRenameField($(".jItem").find("[data-id="+ex.closest(".jTmpPopup").data("id")+"]"))}e.stopPropagation()}else if(ex.is(".btn_editing_permissions_popup")){showEditingPermissionsPopup(ex)}}function keyupHandlers(e){var ex=$(e.target);if(ex.is(".j-object-rename-field")){var closest=ex.closest(".jItem"),id=closest.data("id"),title_object=closest.find(".j-object-title"),old_title=title_object.text().trim(),new_title=ex.val().trim();if(e.keyCode===13&&new_title!==""){title_object.text(new_title).attr("title",title_object.attr("title").replace(old_title,new_title));$.post("/worksheet/renametitle",{id:id,title:new_title}).done(function(data){if(data.type=="success"){ex.attr("placeholder",new_title).val("")}else{window.GGBT_gen_msg.msg(data.message);title_object.text(old_title).attr("title",title_object.attr("title").replace(new_title,old_title))}}).fail(function(error){console.error(error)});e.preventDefault();setRenameState(ex.closest(".jItem"),false)}else if(e.keyCode===27){e.preventDefault();setRenameState(ex.closest(".jItem"),false)}}}function blurHandlers(e){var ex=$(e.target);if(ex.is(".j-object-rename-field")){setRenameState(ex.closest(".jItem"),false,true)}}function toggleRenameField(object){var titleContainer=object.find(".j-object-title-container");var renameField=object.find(".j-object-rename-field");titleContainer.toggleClass("rename-title");object.find(".j-object-title").toggle();renameField.toggle();if(renameField.is(":visible")){renameField.val(renameField.attr("placeholder"));renameField.select();renameField.focus()}window.GGB_general.closePopups()}function setRenameState(object,renameState,skipBlur){var titleContainer=object.find(".j-object-title-container");var renameField=object.find(".j-object-rename-field");if(renameState){titleContainer.addClass("rename-title");object.find(".j-object-title").hide();renameField.show();renameField.trigger("focus")}else{titleContainer.removeClass("rename-title");object.find(".j-object-title").show();renameField.hide();if(skipBlur===true){return}renameField.blur()}}function postWorksheetToGroup(material_id,group_id){var obj={material_id:material_id,group_id:group_id};$.ajax("/group/importworksheet/",{async:true,data:obj}).success(function(response){if(response.type==="success"){window.location="/group/stream/id/"+response.newData.sharingkey}else{window.GGBT_gen_edit.setSaveStateError(response.message);$.modal.close()}}).fail(function(response){window.GGBT_gen_edit.setSaveStateError(response.responseText)})}function deleteGroup(button){var data={};var entity={};entity.group_id=button.data("id");entity.isDeleted=1;data.data=entity;$.post("/group/delete",data).done(function(data){var success=data.type==="success";if(success){window.location=data.newData.redirectUrl}else{window.GGBT_gen_edit.setSaveStateError(data.message)}})}function showChaptersOfBook(bookId,groupId){var onSuccess=function(bookId,groupId){$(".coll-import-back-btn").hide();$(".jImportChapter").each(function(){this.checked=true});$(".coll-import-book-btn").on("click",function(){var arr=[];if($(".jImportChapter").length){$(".jImportChapter").each(function(){if($(this).is(":checked")&&$(this).parents(".import-book-dtls-chpt").data("materials")){var materials=$(this).parents(".import-book-dtls-chpt").data("materials").split(",");arr=arr.concat(materials)}})}else if($("#nochapters_info").data("materials")){arr=arr.concat($("#nochapters_info").data("materials").split(","))}arr=arr.map(function(m){var idandsharing=m.split("-");if(idandsharing[1]){return"id:"+idandsharing[1]}return'id:"'+idandsharing[0]+'"'});if($(".jImportChapter").length>0&&arr.length<=0){window.alert($(this).data("nothing-selected"));return false}var obj={id:bookId,materials:arr.join(" "),group_id:groupId};$.ajax("/group/importbook/",{async:true,data:obj}).success(function(response){if(response.type==="success"){window.location="/group/stream/id/"+response.newData.sharingkey}else{window.GGBT_gen_edit.setSaveStateError(response.message);$.modal.close()}}).fail(function(response){window.GGBT_gen_edit.setSaveStateError(response.responseText)})})};window.GGBT_gen_modal.showAjaxPopup("/book/importdetails/mid/"+bookId,{},{},null,null,function(){onSuccess(bookId,groupId)})}function showAvailableGroups(button){$.ajax("/group/list",{async:true}).success(function(response){if(response.type==="success"){var material_id=$(button).data("id");var material_type=$(button).data("type");var groupId=null;if(response.newData.length>0){var groups=response.newData;var popup=$("#group-select-popup-container").clone();$("#selectgroup",popup).find("option:not(:first)").remove();$.each(groups,function(key,group){$("#selectgroup",popup).append($('<option value="'+group.group_id+'">'+group.title+"</option>"))});var openFunct=function(elem){$("#selectgroup_btn",elem).on("click",function(){$.modal.close();groupId=$("#selectgroup",elem).val();if(material_type==="book"){showChaptersOfBook(material_id,groupId)}else{postWorksheetToGroup(material_id,groupId)}})};window.GGBT_gen_modal.showPopup(popup,{},popup.data("heading"),function(){openFunct(popup)});window.GGBT_gen_modal.resetHeight()}else{showChaptersOfBook(material_id,0)}}else{window.GGBT_gen_edit.setSaveStateError(response.message)}}).fail(function(response){window.GGBT_gen_edit.setSaveStateError(response.responseText)})}function showEditingPermissionsPopup(button){var url=button.data("url");var right=button.data("right");window.GGBT_gen_modal.showAjaxPopup(url,{id:button.data("id")},{className:"popup-editing-permissions popup-easing",autoPosition:true,autoResize:true},button.data("title"),function(){},function(){$(".button.popup-opt."+right).attr("checked",true);$(".button.popup-opt").click(function(e){var url=$(e.target).parents(".formbox.editing-permissions-container").data("callurl")+$(e.target).data("callurl");window.GGBT_gen_edit.setSaveStateInProgress();$.ajax(url).done(function(result){button.data("right",$(e.target).val());window.GGBT_gen_edit.setSaveStateSuccessful()}).fail(function(result){window.GGBT_gen_edit.setSaveStateError(result)})});initAdvancedAccessSettingsPopup()});window.GGBT_gen_modal.resetHeight()}var advancedAccessSettingsPopupInitialized=false;function initAdvancedAccessSettingsPopup(){if(!advancedAccessSettingsPopupInitialized){$("body").on("click",function(e){if($(e.target).is(".btn_advanced_access_settings_popup, .btn_mng_user_access, .material-list .decorator.shared.isowner, .material-list .meta-not-public-info.isowner, .decorator.shared.isowner, .meta-not-public-info.isowner, .btn_mng_user_access")){if($(e.target).attr("disabled")!=="disabled"){$.modal.close();showAdvancedAccessSettings($(e.target))}}});advancedAccessSettingsPopupInitialized=true}}function showAdvancedAccessSettings(button){var url=button.data("url");window.GGBT_gen_modal.showAjaxPopup(url,{id:button.data("id")},{className:"popup-advanced-access",autoPosition:true,autoResize:true},button.data("title"),function(){},function(){window.GGBT_clb_shareoptions.init()})}function initObjects(){if($("time.timeago").length>0){$("time.timeago").timeago()}window.GGBT_gen_backURL.init()}function initAllHandlers(){$("body").on("click",buttonClickHandlers).on("keyup","input, textarea",keyupHandlers).on("blur","input, textarea",blurHandlers);initAdvancedAccessSettingsPopup()}return{initAllHandlers:initAllHandlers,initObjects:initObjects,initOnLoad:initOnLoad,initAdvancedAccessSettingsPopup:initAdvancedAccessSettingsPopup}}();$(document).ready(function(){"use strict";window.GGBT_objects_general.initAllHandlers();window.GGBT_objects_general.initObjects();window.GGBT_objects_general.initOnLoad()});